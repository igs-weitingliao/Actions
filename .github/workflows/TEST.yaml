name: Get Release Info
run-name: "[測試] Trigger 發佈版本 ${{ github.event.inputs.input_tag }}"

on:
  workflow_dispatch:
    inputs:
      input_tag:
        description: "Release tag to fetch info for"
        required: true

jobs:
  ShowReleaseInfo:
    runs-on: ubuntu-latest
    steps:
      - name: Get Release Info
        uses: igs-weitingliao/test_release_summary_for_approval@main
        with:
          org: "igs-weitingliao"
          repo: "TestArtifacts"
          tag: ${{ github.event.inputs.input_tag }}
          token: ${{ secrets.REPO_RELEASE_INFO_PAT  }}

      - name: Show Release Summary
        run: |
          echo -e "$(cat $GITHUB_STEP_SUMMARY)" > $GITHUB_STEP_SUMMARY

  Approval:
    runs-on: ubuntu-latest
    needs: ShowReleaseInfo
    environment:
      name: prod
    steps:
      - name: Show Approval Result
        if: ${{ success() }}
        run: |
          echo "簽核結果: APPROVED ✅"

      - name: Show Rejected
        if: ${{ failure() }}
        run: |
          echo "簽核結果: REJECTED ❌"
